# Funcionamiento del ADKScorerV3 - Explicaci√≥n Detallada

## üîÑ Flujo Completo del Sistema

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    INICIO: Script de Usuario                         ‚îÇ
‚îÇ                  (test_gemini_v3.py o ETL principal)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                                 ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ 1. INICIALIZACI√ìN      ‚îÇ
                    ‚îÇ ADKScorerV3(project_id)‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ 2. CREACI√ìN DEL AGENTE ADK                     ‚îÇ
                    ‚îÇ =======================================        ‚îÇ
                    ‚îÇ ‚úÖ AQU√ç SE USA GOOGLE ADK                      ‚îÇ
                    ‚îÇ                                                ‚îÇ
                    ‚îÇ from google.adk.agents import LlmAgent         ‚îÇ
                    ‚îÇ from google.adk.models import Gemini           ‚îÇ
                    ‚îÇ                                                ‚îÇ
                    ‚îÇ agent = LlmAgent(                              ‚îÇ
                    ‚îÇ     name="mobility_news_scorer",               ‚îÇ
                    ‚îÇ     model=Gemini(...),                         ‚îÇ
                    ‚îÇ     instruction=SYSTEM_PROMPT,                 ‚îÇ
                    ‚îÇ     output_schema=ScoringResponse              ‚îÇ
                    ‚îÇ )                                              ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                                 ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ 3. RECIBIR NOTICIA     ‚îÇ
                    ‚îÇ scorer.score(news_item)‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ 4. CONSTRUIR PROMPT    ‚îÇ
                    ‚îÇ build_user_prompt()    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ 5. LLAMADA AL AGENTE ADK                        ‚îÇ
                    ‚îÇ =====================================           ‚îÇ
                    ‚îÇ ‚úÖ AQU√ç SE EJECUTA GOOGLE ADK                   ‚îÇ
                    ‚îÇ                                                 ‚îÇ
                    ‚îÇ response = agent.run(user_prompt)               ‚îÇ
                    ‚îÇ                                                 ‚îÇ
                    ‚îÇ Internamente, Google ADK:                       ‚îÇ
                    ‚îÇ ‚Ä¢ Combina system prompt + user prompt           ‚îÇ
                    ‚îÇ ‚Ä¢ Llama a Gemini via Vertex AI                  ‚îÇ
                    ‚îÇ ‚Ä¢ Obtiene respuesta del LLM                     ‚îÇ
                    ‚îÇ ‚Ä¢ Valida contra output_schema (Pydantic)        ‚îÇ
                    ‚îÇ ‚Ä¢ Convierte a ScoringResponse                   ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ 6. EXTRAER RESULTADO VALIDADO                  ‚îÇ
                    ‚îÇ =====================================          ‚îÇ
                    ‚îÇ ‚úÖ RESULTADO YA VALIDADO POR ADK               ‚îÇ
                    ‚îÇ                                                ‚îÇ
                    ‚îÇ scoring_result = response.data["scoring_result"]‚îÇ
                    ‚îÇ # scoring_result es un ScoringResponse validado‚îÇ
                    ‚îÇ                                                ‚îÇ
                    ‚îÇ result = scoring_result.model_dump()           ‚îÇ
                    ‚îÇ # Convierte a dict Python                      ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ 7. VERIFICAR keep      ‚îÇ
                    ‚îÇ if result['keep']:     ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ       ‚îÇ
                    keep=True‚îÇ       ‚îÇkeep=False
                             ‚îÇ       ‚îÇ
                             ‚ñº       ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ 8a. ENRICHED‚îÇ  ‚îÇ 8b. None   ‚îÇ
                    ‚îÇ news item   ‚îÇ  ‚îÇ (descartada)‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ Puntos Clave donde se Usa Google ADK

### üìç **PUNTO 1: Inicializaci√≥n del Agente** (src/adk_scorer_v3.py:45-69)

```python
# Este es el PRIMER punto donde usamos Google ADK

from google.adk.agents import LlmAgent  # ‚úÖ Import de Google ADK
from google.adk.models import Gemini    # ‚úÖ Modelo Gemini del ADK

def __init__(self, project_id: str, ...):
    # Crear configuraci√≥n del modelo Gemini usando ADK
    model = Gemini(
        model="gemini-2.0-flash",
        project=project_id,
        location="us-central1",
        temperature=0.2,
        top_p=0.95,
        max_output_tokens=2048
    )

    # Crear el Agente ADK con output_schema
    self.agent = LlmAgent(
        name="mobility_news_scorer",
        model=model,                           # ‚úÖ Modelo Gemini (ADK)
        instruction=SYSTEM_PROMPT,             # Instrucciones del agente
        output_schema=ScoringResponse,         # ‚úÖ Schema Pydantic
        output_key="scoring_result"            # Clave para el resultado
    )
```

**¬øQu√© hace Google ADK aqu√≠?**
- Crea un "agente inteligente" que encapsula:
  - El modelo Gemini
  - Las instrucciones (system prompt)
  - El schema de salida esperado
  - La clave donde guardar el resultado

---

### üìç **PUNTO 2: Ejecuci√≥n del Agente** (src/adk_scorer_v3.py:90-95)

```python
# Este es el SEGUNDO punto - la llamada real al agente

def score(self, news_item: Dict) -> Optional[Dict]:
    # Construir el prompt del usuario
    user_prompt = build_user_prompt(news_item)

    # ‚úÖ AQU√ç SE EJECUTA GOOGLE ADK
    response = self.agent.run(user_prompt)

    # El response ya viene validado por el output_schema
```

**¬øQu√© hace `agent.run()` internamente?**

1. **Combina prompts:**
   - System prompt (instrucciones del agente)
   - User prompt (datos de la noticia)

2. **Llama a Gemini:**
   - Usa Vertex AI API
   - Env√≠a el prompt completo
   - Recibe respuesta del LLM

3. **Valida la respuesta:**
   - Parsea el JSON devuelto por Gemini
   - Valida contra `ScoringResponse` (Pydantic)
   - Si no coincide, lanza error
   - Si coincide, crea objeto validado

4. **Retorna resultado estructurado:**
   - `response.data["scoring_result"]` contiene el `ScoringResponse`

---

### üìç **PUNTO 3: Extracci√≥n del Resultado** (src/adk_scorer_v3.py:97-105)

```python
# El resultado ya est√° validado por Google ADK

# Extraer el resultado validado
scoring_result = response.data.get("scoring_result")

if not scoring_result:
    return None

# Convertir de Pydantic a dict
result = scoring_result.model_dump()

# result es un dict con estructura garantizada:
# {
#     "keep": bool,
#     "severity": str,
#     "tags": List[str],
#     "area": str,
#     ...
# }
```

---

## üî¨ Ejemplo Concreto Paso a Paso

Imaginemos que llega esta noticia:

```python
news_item = {
    "title": "Suspensi√≥n temporal de servicio en L√≠nea A del Metro",
    "body": "El Metro informa suspensi√≥n por mantenimiento...",
    "source": "Metro de Medell√≠n",
    "published_at": "2025-10-29T10:00:00",
    "url": "https://..."
}
```

### **Paso 1: Llamada Inicial**

```python
scorer = ADKScorerV3(project_id="mi-proyecto")
result = scorer.score(news_item)
```

### **Paso 2: Construcci√≥n del Prompt**

```python
user_prompt = """
Analiza la siguiente noticia y determina su relevancia...

**Fuente:** Metro de Medell√≠n
**T√≠tulo:** Suspensi√≥n temporal de servicio en L√≠nea A del Metro
**Contenido:** El Metro informa suspensi√≥n por mantenimiento...
**Fecha de publicaci√≥n:** 2025-10-29T10:00:00

Responde en formato JSON seg√∫n las instrucciones del sistema.
"""
```

### **Paso 3: Google ADK en Acci√≥n**

```python
# ‚úÖ Esto es lo que hace Google ADK internamente:

# 1. Combinar prompts
full_prompt = SYSTEM_PROMPT + "\n\n" + user_prompt

# 2. Llamar a Gemini via Vertex AI
gemini_response = vertex_ai_client.generate_content(
    model="gemini-2.0-flash",
    prompt=full_prompt
)

# 3. Gemini responde (texto JSON):
gemini_text = """{
    "keep": true,
    "severity": "high",
    "tags": ["metro", "suspension", "urgente"],
    "area": "Linea_A_Metro",
    "entities": ["Metro de Medell√≠n"],
    "summary": "Suspensi√≥n temporal por mantenimiento",
    "relevance_score": 0.95,
    "reasoning": "Afecta transporte principal"
}"""

# 4. Google ADK valida con Pydantic
try:
    scoring_response = ScoringResponse.model_validate_json(gemini_text)
    # ‚úÖ Validaci√≥n exitosa - todos los campos correctos
except ValidationError as e:
    # ‚ùå Si falla validaci√≥n, ADK lanza error
    raise

# 5. Retorna respuesta estructurada
return AgentResponse(
    data={"scoring_result": scoring_response}
)
```

### **Paso 4: Tu C√≥digo Recibe el Resultado**

```python
# Esto es lo que recibes en tu c√≥digo:
response = agent.run(user_prompt)

scoring_result = response.data["scoring_result"]
# scoring_result es un ScoringResponse validado

result = scoring_result.model_dump()
# result = {
#     "keep": True,
#     "severity": "high",
#     "tags": ["metro", "suspension", "urgente"],
#     "area": "Linea_A_Metro",
#     "entities": ["Metro de Medell√≠n"],
#     "summary": "Suspensi√≥n temporal por mantenimiento",
#     "relevance_score": 0.95,
#     "reasoning": "Afecta transporte principal"
# }

# ‚úÖ GARANTIZADO: Todos los campos existen y tienen el tipo correcto
```

---

## üÜö Comparaci√≥n: SDK vs ADK

### **Versi√≥n Anterior (V2 - SDK)**

```python
# ‚ùå Sin Google ADK

import google.generativeai as genai

# Llamada directa al SDK
model = genai.GenerativeModel("gemini-2.0-flash")
response = model.generate_content(prompt)

# Parsing manual - puede fallar
try:
    result = json.loads(response.text)

    # Validaci√≥n manual - tediosa y propensa a errores
    if "keep" not in result:
        raise ValueError("Missing 'keep' field")
    if "tags" not in result or not isinstance(result["tags"], list):
        raise ValueError("Invalid 'tags' field")
    # ... m√°s validaciones manuales

except json.JSONDecodeError:
    # ‚ùå JSON inv√°lido - manejo manual
    return None
except ValueError as e:
    # ‚ùå Campos faltantes - manejo manual
    return None
```

### **Versi√≥n Nueva (V3 - ADK)**

```python
# ‚úÖ Con Google ADK

from google.adk.agents import LlmAgent
from schemas.scoring_schema import ScoringResponse

# Crear agente con schema
agent = LlmAgent(
    model=Gemini(...),
    instruction=SYSTEM_PROMPT,
    output_schema=ScoringResponse  # ‚úÖ Validaci√≥n autom√°tica
)

# Llamada simple
response = agent.run(prompt)
result = response.data["scoring_result"].model_dump()

# ‚úÖ GARANTIZADO:
# - JSON v√°lido
# - Todos los campos presentes
# - Tipos correctos
# - Sin necesidad de try/except
```

---

## üß© Componentes del Google ADK Usados

### 1. **`google.adk.agents.LlmAgent`**
- **Qu√© es:** Clase principal para crear agentes basados en LLMs
- **D√≥nde se usa:** `adk_scorer_v3.py` l√≠nea 56
- **Qu√© hace:** Encapsula modelo + instrucciones + validaci√≥n

### 2. **`google.adk.models.Gemini`**
- **Qu√© es:** Configuraci√≥n del modelo Gemini para ADK
- **D√≥nde se usa:** `adk_scorer_v3.py` l√≠nea 47
- **Qu√© hace:** Define par√°metros del modelo (temperature, top_p, etc.)

### 3. **`output_schema` (Pydantic)**
- **Qu√© es:** Schema de validaci√≥n autom√°tica
- **D√≥nde se define:** `src/schemas/scoring_schema.py`
- **Qu√© hace:** Garantiza que la respuesta del LLM sea v√°lida

### 4. **`agent.run(prompt)`**
- **Qu√© es:** M√©todo para ejecutar el agente
- **D√≥nde se usa:** `adk_scorer_v3.py` l√≠nea 94
- **Qu√© hace:** Toda la magia - llamada + validaci√≥n + respuesta

---

## üìä Flujo de Datos Interno

```
Noticia ‚Üí build_user_prompt() ‚Üí Prompt texto
                                      ‚Üì
                            agent.run(prompt)
                                      ‚Üì
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ   GOOGLE ADK INTERNO    ‚îÇ
                        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                        ‚îÇ 1. Combina prompts      ‚îÇ
                        ‚îÇ 2. Llama Vertex AI      ‚îÇ
                        ‚îÇ 3. Recibe texto de LLM  ‚îÇ
                        ‚îÇ 4. Parsea JSON          ‚îÇ
                        ‚îÇ 5. Valida con Pydantic  ‚îÇ
                        ‚îÇ 6. Crea ScoringResponse ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚Üì
                        response.data["scoring_result"]
                                     ‚Üì
                        ScoringResponse (validado)
                                     ‚Üì
                        .model_dump() ‚Üí dict
                                     ‚Üì
                        Resultado final (JSON garantizado)
```

---

## üéì Conclusi√≥n

**Google ADK se usa en dos momentos cr√≠ticos:**

1. **Inicializaci√≥n** (`__init__`): Crear el agente con `LlmAgent`
2. **Ejecuci√≥n** (`score`): Llamar al agente con `agent.run()`

**Ventajas de usar Google ADK:**
- ‚úÖ Validaci√≥n autom√°tica con Pydantic
- ‚úÖ Sin parsing manual de JSON
- ‚úÖ Manejo de errores simplificado
- ‚úÖ Schema garantizado en producci√≥n
- ‚úÖ Base para multi-agent systems

**Lo que Google ADK hace por ti:**
- Combina prompts inteligentemente
- Llama a Vertex AI / Gemini
- Valida la respuesta autom√°ticamente
- Convierte a objetos tipados
- Maneja errores de forma robusta

---

¬øQued√≥ m√°s claro c√≥mo funciona el flujo y d√≥nde exactamente se usa Google ADK? üöÄ
